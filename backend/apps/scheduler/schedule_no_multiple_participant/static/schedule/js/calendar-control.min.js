let calendarWidth;let calendarMode="events";let availableDates=[];let drag=false;let calendarInitialWidth;let hdqControlText='<option value="__HEADQUARTER_VALUE__">__HEADQUARTER_LABEL__</option>';function setMultipleHeadquarters(){if(gUserHeadquarters.length>1){$(".fc-left").append('<div class="btn-group" role="group"><button class="dropdown-toggle btn btn-default" type="button"\ndata-toggle="dropdown" id="user_headquerters_btn" aria-haspopup="true"\naria-expanded="false">Oddział</button>\n<div class="dropdown-menu" aria-labelledby="user_headquerters_btn"><ul data-choosen="" id="user_headquerters_list"></ul></div></div>');$.each(gUserHeadquarters,function(a,b){$("#user_headquerters_list").append(hdqControlText.replace("__HEADQUARTER_VALUE__",b.id).replace("__HEADQUARTER_LABEL__",b.name))})}}function setHeadquarters(){$(".fc-left").append('<div class="btn-group" role="group"><select id="user_headquarters_list" class="form-control input-sm"><option value="" style="color: #969696;">wszystkie dostępne oddziały</option></select></div>');$.each(gUserHeadquarters,function(a,b){$("#user_headquarters_list").append(hdqControlText.replace("__HEADQUARTER_VALUE__",b.id).replace("__HEADQUARTER_LABEL__",b.name))})}$(document).ready(function(){$("#calendar").fullCalendar({customButtons:{filter:{text:"Filtruj",click:function(){$("#scheduleFilterModal").modal("show")}},eventRoomToggle:{text:"Widok sal",click:function(){toggleCalendarMode()}},fullScreen:{icon:"fa-search",click:function(){toggleCalendarWindow()}},zoomIn:{icon:"fa-arrow-right",click:function(){zoomCalendar("+")}},zoomOut:{icon:"fa-arrow-left",click:function(){zoomCalendar("-")}},zoomDefault:{icon:"",click:function(){zoomCalendar()}},vZoomIn:{icon:"fa-arrow-left",click:function(){vZoomCalendar("+")}},vZoomOut:{icon:"fa-arrow-left",click:function(){vZoomCalendar("-")}},vZoomDefault:{icon:"",click:function(){vZoomCalendar()}}},buttonText:{today:"Dziś",month:"M-c",week:"Tydz.",bussinessWeek:"Tydz. rob.",day:"Dz.",list:"list"},header:{left:"prev,next today, filter,eventRoomToggle",center:"title",right:"vZoomIn,vZoomDefault,vZoomOut, zoomOut,zoomDefault,zoomIn, month,agendaWeek,businessWeek,agendaDay, fullScreen"},views:{businessWeek:{type:"agendaWeek",duration:{days:7},buttonText:"Tydz. rob.",title:"",scrollTime:gWorkingHours.start,columnFormat:"ddd DD.MM",hiddenDays:[0,6]}},themeSystem:"bootstrap3",slotEventOverlap:false,slotDuration:"00:15:00",snapDuration:"00:15:00",allDaySlot:false,defaultView:"agendaWeek",scrollTime:gWorkingHours.start,contentHeight:600,businessHours:{dow:[1,2,3,4,5],start:gWorkingHours.start,end:gWorkingHours.end},lang:"pl",selectable:true,selectHelper:true,editable:true,eventLimit:true,displayEventTime:false,weekNumberCalculation:"ISO",firstDay:"1",compareEventSegs:function(a,b){return sortEventByCustomParam(a.event,b.event)},viewRender:function(){$("#calendar div.fc-slats table tbody tr").each(function(){if($(this).data("time").substring(3)=="00:00"){$(this).addClass("calendar-full-hour-tr");$(this).find("td").addClass("calendar-full-hour-td")}});if(calendarWidth){$("#calendar .fc-view").width(calendarWidth)}$(".fc-fullScreen-button").html('<i class="fa fa-arrows-alt"></i>');$(".fc-zoomIn-button").html('<i class="fa fa-arrow-right"></i>');$(".fc-zoomOut-button").html('<i class="fa fa-arrow-left"></i>');$(".fc-zoomDefault-button").html('<i class="fa fa-circle-o"></i>');$(".fc-vZoomIn-button").html('<i class="fa fa-arrow-down"></i>');$(".fc-vZoomOut-button").html('<i class="fa fa-arrow-up"></i>');$(".fc-vZoomDefault-button").html('<i class="fa fa-circle-o"></i>')},eventOrder:function(){return false},select:function(b,a){let mEnd=$.fullCalendar.moment(a);let mStart=$.fullCalendar.moment(b);if(mEnd.isAfter(mStart,"day")){$("#calendar").fullCalendar("unselect");swal("Zdarzenia wielodniowe są nie dozwolone.","Można tworzyć zdarzenia jedynie w obrębie jednego dnia","warning");return}resetEventForm("schedule-form","basic");setEventFormAccess(false);setInitialData(b,a);getAvailableMeetingRooms(b.format("YYYY-MM-DD HH:mm"),a.format("YYYY-MM-DD HH:mm"));$("#submit-btn").show();$("#addScheduleFormModal").modal("show")},events:function(d,a,b,c){$(".tooltip").tooltip("hide");$(".loader-container").fadeIn();getEvents(d,a,c)},eventClick:function(c,b,a){$(".popover").popover("hide");if(!c.viewable){swal("Brak uprawnień do przeglądania szczegółów","","warning");return}resetEventForm("schedule-form","advanced");getEventData(c,calendar_get_event_url)},eventResize:function(b,c,a){moveEvent(calendar_move_event_url,b);b.data.confirmed=false},eventDrop:function(b,c,a){moveEvent(calendar_move_event_url,b);b.data.confirmed=false},eventDragStart:function(b,a){drag=true;$(".tooltip").tooltip("hide");$(".popover").popover("hide")},eventDragStop:function(){drag=false},eventRender:function(b,a){$(".tooltip").tooltip("hide");$(".popover").popover("hide");if(b.id){if(b.viewable){if(!drag&&b.rendering!=="background"){let tooltip_text="<div><strong>"+b.title+"</strong> "+moment(b.start).format("HH:mm")+" - "+moment(b.end).format("HH:mm")+"</div><div><span>Właściciel: </span>"+b.data.host_user.first_name+" "+b.data.host_user.last_name+"</div>";if(b.data.address.length){tooltip_text+="<div><span>Lokalizacja: </span>"+b.data.address+"</div>"}if(b.data.invited_users.length){tooltip_text+="<div>Uczestnicy:</div>";$.each(b.data.invited_users,function(c,d){tooltip_text+="<div>"+d.first_name+" "+d.last_name+"</div>"})}$(a).tooltip({title:tooltip_text,html:true,placement:"auto",container:"body"})}a.find(".fc-content").append('<div style="display:inline-block">'+fillUserDataLink(b.data.host_user,"userdata-lnk")+(b.data.address?" - "+b.data.address:"")+"</div>");if(!b.data.single_person){for(let i in b.data.invited_users){a.append('<div style="width:100%; overflow:hidden; display:inline-block;">'+fillUserDataLink(b.data.invited_users[i],"userdata-lnk")+"</div>")}}a.contextmenu(function(){return false});a.mousedown(function(c){if(c.button===2){setEventPopover($(this),b);return false}return true});if(b.data&&!b.data.confirmed){a.find(".fc-bg").addClass("event-not")}a.find(".fc-content").css("background",b.color)}else{if(calendar_mode!=="room"){a.find(".fc-content").text("Zdarzenie")}a.css("background","#AAAAAA");a.find(".fc-content").css("background","#777777")}if(!b.data.resizable){a.find(".fc-end-resizer").hide()}if(b.data.status==="AN"){a.css("opacity",0.6);if(b.data.status==="AN"){a.find(".fc-title").css("text-decoration","line-through")}}else{if(b.data.status==="CL"){a.find(".fc-title").css("font-style","italic")}}if(b.editable){a.find(".fc-title").css("text-decoration","underline");a.find(".fc-title").css("font-weight",700)}}},eventAfterRender:function(c,b,a){},eventAfterAllRender:function(a){$(".loader-container").fadeOut()}});setHeadquarters();$("#user_headquarters_list").change(function(){$("#calendar").fullCalendar("refetchEvents")})});